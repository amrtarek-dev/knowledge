By knowing what is normal, we can easily spot what is abnormal.
## IoC
Indicators of compromise which are observable evidence that suggests signs of potential security incident.

like : exfiltration: unauthorized transmission of data from a system. (Attackers use data exfilteration to steal or lead data such as usernames, passwords by observing network traffic).


## Monitor Network
determined a baseline by knowing of normal network behavior, you will be better able to identify abnormal network behavior.

Component that can be monitored to detect malicious activity:
- Flow analysis
Protocols and ports not always associated, do port 443 commonly used by HTTPS but malicious actors can use protocols and ports that are not commonly associated to maintain communication  between compromised system and their own machine. (Command and Control C2 attack).
- Packet payload information
Organizations can monitor the payload information of packets to uncover unusual activity, such as sensitive data transmitting outside of the network, which could indicate a possible data exfiltration attack.
- Temporal patterns
If large volumes of traffic are suddenly outside of the normal hours of network activity, then this is considered _off baseline_ and should be investigated.

**SOC (Security Operations Center)** which monitoring systems against security threats and attack, 
and **NOC (Network Operations Center)** for monitoring performance of a network and response to any network disruption.

Security Analyst monitor networks to identify any signs of IoC (indicators of Compromise)

## Network monitoring tools
- IDS : monitor system activity and alert on possible intrustions.
- Network protocol analyzers (Packet sniffers): Capture and and analyze data traffic within a network.

[Network Traffic - MITRE ATT&CK](https://attack.mitre.org/datasources/DS0029/)
[ data exfiltration techniques - MITRE ATT&CK®](https://attack.mitre.org/tactics/TA0010/)


## Exfiltration attack
is the term for unauthorized transmission of data from a system.
1. initial access: access into a network and computer system (Social engineering (phishing)).
2. Maintain access, avoid being detected for as long as possible. (lateral movement / Pivoting)
	1. An attacker has infiltrated a network. Next, they spend time exploring it in order to expand and maintain their access. They look for valuable assets such as proprietary code and financial records.
	2. exploring the network with the goal of expanding and maintaining their access to other systems (Identify valuable assets(PII))
		1. search in file shares, intranet sites, code repositories, ...
3. collect package and prepare the data for exfiltration of the organization's network.
	1. Reduce the data size
	2. Email the stolen data to themselves using the compromised email account.

**To prevent**
1. Prevent the attacker access
2. Monitor network activity
3. Protect assets (Assets inventory and security control)
4. Detect and stop the exfiltration. (SIEM)


## Network Packets
it is the data in network: is a basic unit of information that travels from one device to another within a network.
- Header: information like type of network protocol and port being used, can have several headers depending on the protocols used
	- Network protocol: a set of rules that determine the transmission of data between devices.
	- Port are non physical locations on a computer that organize data transmission of data between devices on a network.
	- Also contains the packet's source and destination ip address.
- Payload: the content, the actual data being delivered
- Footer: Signifies the end of the packets, also known as the trailer, is located at the end of a packet, Most protocols, such as the Internet Protocol (IP), _do not_ use footers.

## Network protocol analyzer (packet sniffer)
A tool designed to capture and analyze data traffic within network.
Network protocol analyzers use both software and hardware capabilities to capture network traffic and display it for security analysts to examine and analyze

First, packets must be collected from the network via the **Network Interface Card (NIC)**, which is hardware that connects computers to a network, like a router. NICs receive and transmit network traffic, but by default they only listen to network traffic that’s addressed to them. To capture all network traffic that is sent over the network, a NIC must be switched to a mode that has access to all visible network data packets.

In wireless interfaces this is often referred to as monitoring mode, and in other systems it may be called promiscuous mode. This mode enables the NIC to have access to all visible network data packets.

The network protocol analyzer collects the network traffic in raw binary format. Binary format consists of 0s and 1s and is not as easy for humans to interpret. The network protocol analyzer takes the binary and converts it so that it’s displayed in a human-readable format, so analysts can easily read and understand the information.

Tools:
- Tcpdump
- Wireshark

## Packet Capture (P-cap)
A file containing data packets intercepted from an interface or network.
P-cap files can come in many formats depending on the packet capture library that’s used:
- **Libpcap** is a packet capture library designed to be used by Unix-like systems, like Linux and MacOS®. Tools like tcpdump use Libpcap as the default packet capture file format.
- **WinPcap** is an open-source packet capture library designed for devices running Windows operating systems. It’s considered an older file format and isn’t predominantly used.
- **Npcap** is a library designed by the port scanning tool Nmap that is commonly used in Windows operating systems.
- **PCAPng** is a modern file format that can simultaneously capture packets and store data. Its ability to do both explains the “ng,” which stands for “next generation.”

## TCP IP model
It is a framework that is used to visualize how data is organized and transmitted across a network.
- **Application**
- **Transport**
- **Internet**: accept and delivers packets where the Internet Protocol (IP) operates.
- **Network Access**

### Packet Header V4
- **Version**: V4, v6
- **IHL**: Internet header length
- **ToS**: Type of Service
- **Total Length**: The length of the entire package (Header + Data)
- **Identification**, **Flags**, **Fragment Offset**: deal with information related to fragmentation (Fragmentation when IP packet gets broken up into chunks)
	- **Fragment Offset**: This field is used to identify the correct sequence of fragments.
- **TTL**: Time to live (How long the packet can live before it dropped)
- **Protocol**: specify the protocol used. (ex: TCP = 6)
- **Header Checksum**: has a value of checksum to determine if any errors have occurred in the header.
- **Source Address**: Source IP address
- **Destination Address**: Destination IP address.
- **Options**: normally used for troubleshooting.

### Packet Header V6
- **Version**: This field indicates the IP version. For an IPv6 header, IPv6 is used.
- **Traffic Class**: This field is similar to the IPv4 Type of Service field. The Traffic Class field provides information about the packet's priority or class to help with packet delivery.
- **Flow Label**: This field identifies the packets of a flow. A flow is the sequence of packets sent from a specific source. 
- **Payload Length**: This field specifies the length of the data portion of the packet.
- **Next Header**: This field indicates the type of header that follows the IPv6 header such as TCP.
- **Hop Limit**: This field is similar to the IPv4 Time to Live field. The Hop Limit limits how long a packet can travel in a network before being discarded.
- **Source Address**: This field specifies the source address of the sender.
- **Destination Address**: This field specifies the destination address of the receiver.


**Tcpdump** is a command-line network protocol analyzer. Recall that a **command-line interface (CLI)** is a text-based user interface that uses commands to interact with the computer.

``` bash
sudo tcpdump [-i interface] [option(s)] [expression(s)]
```

You can use the -D flag to list the network interfaces available on a system

``` bash
sudo tcpdump -i any -c 3
# -c stands for count
sudo tcpdump -i any -w packetcapture.pcap
# to read a packet capture file
sudo tcpdump -r packetcapture.pcap
# -v There are three levels of verbosity -vv, -vvv
sudo tcpdump -r packetcapture.pcap -v
# -n By default, tcpdump will perform name resolution.
# Using the -n flag disables this automatic mapping of numbers to names and is considered to be best practice when sniffing or analyzing traffic.
# Using -n will not resolve hostnames, whereas -nn will not resolve _both_ hostnames or ports
sudo tcpdump -r packetcapture.pcap -v -n
# -X: Display the hexadecimal and ASCII output format packet data. Security analysts can analyze hexadecimal and ASCII output to detect patterns or anomalies during malware analysis or forensic analysis.
sudo tcpdump -nn -r capture.pcap -X
```

Expressions
``` bash
# To read the packetcapture.pcap file and combines two expressions ip and port 80 using the and boolean operator
sudo tcpdump -r packetcapture.pcap -n 'ip and port 80'
```